<!doctype html>
<html lang="cs">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover,user-scalable=no">
<title>Šachové stopky</title>

<style>
*{box-sizing:border-box}
html,body{
  margin:0;height:100%;
  font-family:system-ui,Segoe UI,Roboto,Arial,sans-serif;
  background:#0b1220;color:#e8eefc
}
button,input{font:inherit}

/* ===== SETUP ===== */
#setup{
  height:100%;
  display:flex;
  justify-content:center;
  align-items:center;
  padding:20px
}
.card{
  background:#121a2c;
  padding:22px;
  border-radius:18px;
  width:min(520px,100%);
  box-shadow:0 10px 30px rgba(0,0,0,.4)
}
h1{margin:0 0 18px;font-size:28px}
label{display:block;margin-bottom:6px;color:#9fb0d6;font-weight:600}
input{
  width:100%;
  padding:14px;
  border-radius:12px;
  border:1px solid rgba(255,255,255,.2);
  background:#0003;color:white;
  outline:none;
}
.btn{
  width:100%;
  margin-top:14px;
  padding:14px;
  border-radius:12px;
  border:0;
  background:#2a5cff;
  color:white;
  font-weight:800;
  cursor:pointer
}

/* ===== CLOCK ===== */
#clock{
  position:fixed;
  inset:0;
  background:black;
  display:none;
  user-select:none;
  -webkit-user-select:none;
  -webkit-tap-highlight-color: transparent;
  touch-action:manipulation;
}
.half{
  height:50%;
  display:flex;
  justify-content:center;
  align-items:center;
}
.white{background:white;color:black}
.black{background:black;color:white}

.time{
  font-size:min(18vw,110px);
  font-weight:900;
  font-variant-numeric:tabular-nums;
  line-height:1;
}

/* Default: proti sobě — černý čas otočený o 180° */
.black .time{transform:rotate(180deg)}

/* Režim "stejná strana": oba časy otoč o 90° a černý už NEotáčej 180° */
#clock.sameSide .time{ transform:rotate(90deg); }
#clock.sameSide .black .time{ transform:rotate(90deg); } /* override */

#center{
  position:absolute;
  left:50%;top:50%;
  transform:translate(-50%,-50%);
  display:flex;
  gap:10px;
  align-items:center;
  justify-content:center;
  z-index:10;
}
.ctrlBtn{
  width:54px;
  height:54px;
  border-radius:999px;
  border:1px solid rgba(255,255,255,.3);
  background:rgba(15,23,41,.82);
  color:white;
  font-weight:900;
  cursor:pointer;
  display:flex;
  align-items:center;
  justify-content:center;
  font-size:22px;
  box-shadow:0 8px 20px rgba(0,0,0,.35);
  backdrop-filter: blur(8px);
  -webkit-backdrop-filter: blur(8px);
}
.ctrlBtn.playing{ background:rgba(15,23,41,.82); }
.ctrlBtn.paused{ background:#2a5cff; border-color: rgba(255,255,255,.22); }

#rotateBtn{ font-size:24px; }

/* ===== OVERLAY ===== */
#overlay{
  position:fixed;
  inset:0;
  display:none;
  background:rgba(0,0,0,.7);
  justify-content:center;
  align-items:center;
  padding:20px;
  z-index:100;
}
#overlay div{
  background:#0f1729;
  padding:20px;
  border-radius:16px;
  font-size:22px;
  font-weight:800;
  text-align:center;
  border:1px solid rgba(255,255,255,.14);
}
</style>
</head>

<body>

<div id="setup">
  <div class="card">
    <h1>Šachové stopky</h1>

    <label for="minutes">Počet minut</label>
    <input id="minutes" type="number" value="10" min="1" inputmode="numeric">

    <label for="incSec" style="margin-top:12px">Přičtení za tah (s)</label>
    <input id="incSec" type="number" value="5" min="0" step="1" inputmode="numeric">

    <button class="btn" id="start">Start</button>
  </div>
</div>

<div id="clock" aria-hidden="true">
  <div id="black" class="half black"><div id="tBlack" class="time">10:00</div></div>
  <div id="white" class="half white"><div id="tWhite" class="time">10:00</div></div>

  <div id="center">
    <button id="pauseBtn" class="ctrlBtn playing" type="button" aria-label="Pauza / Play">⏸</button>
    <button id="rotateBtn" class="ctrlBtn" type="button" aria-label="Otočit časy">⟳</button>
  </div>
</div>

<div id="overlay"><div id="result"></div></div>

<script>
(() => {
  const setup=document.getElementById("setup");
  const clock=document.getElementById("clock");
  const startBtn=document.getElementById("start");
  const minutesEl=document.getElementById("minutes");
  const incSecEl=document.getElementById("incSec");

  const whiteHalf=document.getElementById("white");
  const blackHalf=document.getElementById("black");
  const tWhite=document.getElementById("tWhite");
  const tBlack=document.getElementById("tBlack");

  const pauseBtn=document.getElementById("pauseBtn");
  const rotateBtn=document.getElementById("rotateBtn");

  const overlay=document.getElementById("overlay");
  const result=document.getElementById("result");

  let INC = 5000; // ms, nastavuje se při Start

  let w=0, b=0;
  let active=null;         // "white" | "black" | null
  let running=false;
  let paused=false;
  let gameOver=false;
  let last=0;
  let raf=0;

  let sameSide=false;

  function fmt(ms){
    ms=Math.max(0, ms);
    const s=Math.floor(ms/1000);
    const m=Math.floor(s/60);
    const r=s%60;
    return String(m).padStart(2,"0")+":"+String(r).padStart(2,"0");
  }
  function render(){
    tWhite.textContent=fmt(w);
    tBlack.textContent=fmt(b);
  }

  function setPauseIcon(){
    if (paused){
      pauseBtn.textContent = "▶";
      pauseBtn.classList.add("paused");
      pauseBtn.classList.remove("playing");
    } else {
      pauseBtn.textContent = "⏸";
      pauseBtn.classList.add("playing");
      pauseBtn.classList.remove("paused");
    }
  }

  function showSetup(){
    cancelAnimationFrame(raf);

    running=false;
    paused=false;
    gameOver=false;
    active=null;
    last=0;

    overlay.style.display="none";
    clock.style.display="none";
    clock.setAttribute("aria-hidden","true");
    setup.style.display="flex";

    setPauseIcon();
  }

  function showClock(){
    setup.style.display="none";
    clock.style.display="block";
    clock.setAttribute("aria-hidden","false");
  }

  function tick(ts){
    if(gameOver){
      return;
    }

    if(!running || paused || !active){
      last = ts;
      raf = requestAnimationFrame(tick);
      return;
    }

    const dt = ts - last;
    last = ts;

    if(active==="white"){
      w -= dt;
      if(w<=0){
        w=0; render();
        return end("Bílá prohrála – vyhrála černá");
      }
    }else{
      b -= dt;
      if(b<=0){
        b=0; render();
        return end("Černá prohrála – vyhrála bílá");
      }
    }

    render();
    raf = requestAnimationFrame(tick);
  }

  function end(text){
    gameOver = true;
    running = false;
    paused = false;
    active = null;

    setPauseIcon();

    overlay.style.display="flex";
    result.textContent=text;
  }

  function resetGame(minutes){
    const ms = Math.max(1, minutes|0) * 60000;
    w = ms; b = ms;
    active=null;
    running=false;
    paused=false;
    gameOver=false;
    render();
    setPauseIcon();
  }

  startBtn.addEventListener("click", () => {
    // načti increment v sekundách (0+), ulož do ms
    const incSec = Math.max(0, (parseInt(incSecEl.value, 10) || 0));
    INC = incSec * 1000;

    resetGame(minutesEl.value);
    history.pushState({screen:"clock"}, "");
    showClock();
    cancelAnimationFrame(raf);
    raf = requestAnimationFrame(tick);
  });

  clock.addEventListener("pointerdown", () => {
    if(gameOver) return;
    if(paused) return;
    if(active) return;
    active="white";
    running=true;
    last = performance.now();
  }, {passive:true});

  whiteHalf.addEventListener("pointerdown", (e) => {
    if(active===null) return; // allow first tap to bubble and start white
    e.stopPropagation();
    if(gameOver || paused) return;
    if(active!=="white") return;

    w += INC;
    active="black";
    last = performance.now();
    render();
  });

  blackHalf.addEventListener("pointerdown", (e) => {
    if(active===null) return;
    e.stopPropagation();
    if(gameOver || paused) return;
    if(active!=="black") return;

    b += INC;
    active="white";
    last = performance.now();
    render();
  });

  pauseBtn.addEventListener("pointerdown", (e) => {
    e.stopPropagation();
    if(gameOver) return;
    paused = !paused;
    last = performance.now();
    setPauseIcon();
  });

  rotateBtn.addEventListener("pointerdown", (e) => {
    e.stopPropagation();
    sameSide = !sameSide;
    clock.classList.toggle("sameSide", sameSide);
  });

  history.replaceState({screen:"setup"}, "");

  window.addEventListener("popstate", () => {
    showSetup();
    history.replaceState({screen:"setup"}, "");
  });

  document.addEventListener("contextmenu", (e) => e.preventDefault());

  showSetup();
})();
</script>

</body>
</html>